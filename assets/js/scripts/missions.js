
function missionHandler( ) {
	const missionsPage = document.querySelector("#missions");
	const listMissions = document.querySelector("[list-missions]");
	btnMissions.addEventListener("click", (e) => {
		settings.disableScroll = true;
		missionsPage.classList.toggle("hidden", false);
		// btnMissions.closest("[id]").classList.toggle("noselect", false);

		let dataCount = document.querySelector("[data-missions-count]");
		dataCount.innerText = `ƒê√£ ho√†n th√†nh: ${__missions.unlocked.length}/${__missions.total.length}`;
		listMissions.innerHTML = __missions.total
			.sort((a, b) => {
				return a.rating - b.rating;
			})
			.sort((a, b) => {
				if (a.isHidden && a.isHidden == b.isHidden) {
					return 0;
				}
				if (a.isHidden) return 1;
				if (b.isHidden) return -1;
				return 0;
			})
			.map((v) => {
				let isUnlocked = __missions.isUnlocked(v.id);
				if (v.isHidden) {
					return `<li>
                                <div class="flex gap-x-2 items-center mb-1">
                                    <img src="${
										isUnlocked
											? v.unlockico ||
											  window.assetMap.lazyLoad.src
													.icoEastereggUnl002
											: window.assetMap.lazyLoad.src
													.icoEasteregg
									}" class="w-12 h-12"/>
                                    <div class="flex-1 flex">
                                        <span>${
											v.done
												? `${v.display} (#${
														__missions.getMission(
															v.id
														).index
												  })`
												: `Easter egg (#${
														__missions.getMission(
															v.id
														).index
												  })`
										}</span>
                                        <img src="${
											window.assetMap.lazyLoad.src.icoInfo
										}" class="ms-2 w-3 h-3">
                                    </div>
									<img src="
                                    ${
										isUnlocked
											? window.assetMap.lazyLoad.src
													.icoDone
											: window.assetMap.lazyLoad.src
													.icoUndone
									}" class="w-12 h-12"/>
                                </div>
                                <div class="text-sm md:text-base ${
									v.done ? "" : "h-4 bg-[#1a1b30]"
								}">
                                    ${v.done ? v.description : ""}
                                </div>
                            </li>`;
				}
				return `
                            <li>
                                <div class="flex gap-x-2 items-center mb-1">
                                    <img src="${
										isUnlocked
											? window.assetMap.lazyLoad.src
													.icoTrophy
											: window.assetMap.lazyLoad.src
													.icoTrophyLock
									}" class="w-12 h-12"/>
                                    <div class="flex-1 flex">
                                        <span>${v.display}</span>
                                        <img src="${
											window.assetMap.lazyLoad.src.icoInfo
										}" class="ms-2 w-3 h-3">
                                    </div>
									<img src="${
										isUnlocked
											? window.assetMap.lazyLoad.src
													.icoDone
											: window.assetMap.lazyLoad.src
													.icoUndone
									}" class="w-12 h-12"/>
                                    
                                </div>
                                <div class="text-sm md:text-base">
                                    ${
										v.done
											? v.description
											: `[ƒê·ªô kh√≥: ${
													v.rating || "unk"
											  }/5] ${
													v.hint ||
													"L√†m g√¨ c√≥ g·ª£i √Ω ~"
											  }`
									}
                                </div>
                            </li>
							`;
			})
			.join(" ");
	});
}

const __missions = {
	saveKey: "missions_unlock",
	isUnlocked: (id) => {
		const isUnlocked = __missions.unlocked.findIndex((e) => e.id == id);
		return isUnlocked != -1;
	},
	loadMission: () => {
		let data = window.localStorage.getItem(__missions.saveKey);
		if (data) {
			try {
				data = JSON.parse(data);
			} catch (error) {
				data = [];
			}
		} else {
			data = [];
		}
		data.forEach((e) => {
			const mission = __missions.total.findIndex((v) => v.id == e.id);
			if (mission != -1) {
				__missions.unlocked.push(e);
				__missions.total[mission].done = true;
			}
		});
		setTimeout(() => {
			if (__missions.isUnlocked("cuu_xuc_chi_uoc")) {
				__playlist.push({
					title: "Please Tell Me Why",
					artist: "Easter Egg C≈© (REMASTER)",
					uri: "/assets/sounds/albums/old-easteregg.mp3",
				});
			}
		}, 1000)
	},
	saveMission: (data) => {
		window.localStorage.setItem(__missions.saveKey, JSON.stringify(data));
	},
	loadNotification: (mission) => {
		setTimeout(() => {
			createDoneToast(mission.data);
			setTimeout(() => {
				__missions.queueNotification =
					__missions.queueNotification.filter(
						(v) => v.index != mission.index
					);
				if (__missions.queueNotification.length) {
					__missions.loadNotification(
						__missions.queueNotification[0]
					);
				}
			}, 5500);
		}, 200);
	},
	queueNotification: [],
	getMission: (id) => {
		const index = __missions.total.findIndex((v) => v.id == id);
		if (index == -1) {
			return false;
		}
		return {
			index,
			data: __missions.total[index],
		};
	},
	unlockMission: (id) => {
		const mission = __missions.getMission(id);

		if (!mission) return;
		if (__missions.unlocked.findIndex((v) => v.id == id) != -1) return;

		__missions.queueNotification.push(mission);
		__missions.unlocked.push({
			id,
			time: new Date().getTime(),
		});
		__missions.total[mission.index].done = true;
		__missions.saveMission(__missions.unlocked);

		if (__missions.queueNotification[0].index == mission.index) {
			__missions.loadNotification(mission);
		}

		if (mission.data.id == "cuu_xuc_chi_uoc") {
			__playlist.push({
				title: "Please Tell Me Why",
				artist: "Easter Egg C≈© (REMASTER)",
				uri: "/assets/sounds/albums/old-easteregg.mp3",
			});

			MediaPlayer.controllers.switchMusic(__playlist.length - 1);
			if (MediaPlayer.status == MediaPlayer_Status.pause) {
				MediaPlayer.controllers.playMusic();
			}
		}

		__logger.logToSheet({
			type: "missions-unlock",
			metadata: {
				id: mission.data.id,
				name: mission.data.name,
				isEasterEgg: mission.data.isHidden,
				total: __missions.unlocked.length,
				unlocked: __missions.unlocked,
			},
		});
	},
	unlocked: [],
	total: [
		// added
		{
			id: "chien_binh_ranh_roi",
			name: "Chi·∫øn Binh R·∫£nh R·ªói",
			display: "Chi·∫øn Binh R·∫£nh R·ªói",
			rating: 4,
			isHidden: false,
			description:
				"Kh√¥ng ph·∫£i v√¨ t√≤ m√≤, m√† l√† v√¨ qu√° r·∫£nh.\nH·∫Øn ta ƒë√£ ƒëi ƒë·∫øn n∆°i t·∫≠n c√πng - ƒë·ªÉ l√†m g√¨ ch·ª©?",
			hint: "ƒê·∫øn ranh gi·ªõi c·ªßa th·ªùi kh√¥ng",
		},
		// added
		{
			id: "cuu_xuc_chi_uoc",
			name: "C·ª≠u X√∫c Chi ∆Ø·ªõc",
			display: "C·ª≠u X√∫c Chi ∆Ø·ªõc",
			rating: 5,
			isHidden: true,
			unlockico: "./assets/images/ico-unlockee01.gif",
			description:
				"G√¨ th·∫ø l·ªØ kh√°ch? 9 l·∫ßn? ƒê√≥ l√† c√°ch g·ªçi ta xu·∫•t hi·ªán, ta - Jasper Kennex - S·ªë 09 ƒë·∫øn ƒë√¢y ‚öΩ",
			hint: "Easter egg n√†y thu·ªôc portfolio 2D, ƒëo√°n m√≤ ƒëi, h·∫π h·∫π h·∫π",
		},
		{
			id: "kham_pha_van_vat",
			name: "Kh√°m Ph√° V·∫°n V·∫≠t",
			display: "Kh√°m Ph√° V·∫°n V·∫≠t",
			rating: 5,
			isHidden: false,
			description:
				"V·∫°n v·∫≠t ƒë·ªÅu c√≥ linh. Nh·ªØng k√Ω ·ª©c ƒë√£ ng·ªß qu√™n trong t·ª´ng m√≥n ƒë·ªì ƒëang ch·ªù ƒë∆∞·ª£c ƒë√°nh th·ª©c. B·∫°n c√≥ th·ªÉ nh√¨n th·∫•y ƒëi·ªÅu ng∆∞·ªùi kh√°c kh√¥ng th·∫•y?",
			hint: "",
		},
		{
			id: "the_great_wave_off_kanagawa",
			name: "The Great Wave off Kanagawa",
			display: "L√†n s√≥ng Kanagawa",
			rating: 2,
			isHidden: false,
			description:
				"Gi·ªØa l√†n s√≥ng d·ªØ d·ªôi, v·∫´n c√≥ m·ªôt con thuy·ªÅn d≈©ng c·∫£m v∆∞∆°n m√¨nh ti·∫øn v·ªÅ ph√≠a tr∆∞·ªõc - nh∆∞ c√°ch m√¨nh ƒë·ªëi m·∫∑t th·ª≠ th√°ch trong h√†nh tr√¨nh s√°ng t·∫°o.",
			hint: "üñºÔ∏è",
		},
		// added
		{
			id: "phong_tranh_ao",
			name: "·∫¢o ·∫¢nh Th·∫•t",
			display: "·∫¢o ·∫¢nh Th·∫•t",
			rating: 2,
			isHidden: false,
			description: "M·ªôt cƒÉn ph√≤ng ph·ªß ƒë·∫ßy ·∫£o ·∫£nh. T·∫•t c·∫£. ƒë·ªÅu l√†. k√Ω ·ª©c?",
			hint: "VR Headset",
		},
		// added
		{
			id: "lan_dau_tham_quan",
			name: "Nh·∫≠p C·∫£nh S∆° M√¥n",
			display: "Nh·∫≠p C·∫£nh S∆° M√¥n",
			rating: 1,
			isHidden: false,
			description:
				"M·ªói h√†nh tr√¨nh ƒë·ªÅu b·∫Øt ƒë·∫ßu b·∫±ng m·ªôt b∆∞·ªõc ch√¢n. C·∫£m ∆°n qu√Ω l·ªØ kh√°ch ƒë√£ ƒë·ªÉ b∆∞·ªõc ch√¢n ·∫•y ch·∫°m v√†o n∆°i n√†y.",
			hint: "",
		},
		// added
		{
			id: "chao_mung_tro_lai",
			name: "T√°i Ki·∫øn Chi M√¥n",
			display: "T√°i Ki·∫øn Chi M√¥n",
			rating: 5,
			isHidden: false,
			description:
				"C·∫£m ∆°n qu√Ω l·ªØ kh√°ch ƒë√£ quay tr·ªü l·∫°i. D√π ƒë√£ t·ª´ng ƒë·∫∑t ch√¢n ƒë·∫øn n∆°i n√†y, s·ª± hi·ªán di·ªán c·ªßa b·∫°n h√¥m nay v·∫´n mang theo m·ªôt ƒëi·ªÅu r·∫•t ƒë·∫∑c bi·ªát. Ch√∫c h√†nh tr√¨nh ti·∫øp theo s·∫Ω th·∫≠t tr·ªçn v·∫πn!",
			hint: "3 l·∫ßn tham quan",
		},
		// added
		{
			id: "ghi_danh",
			name: "Ghi Danh S·ªï T·ªãch",
			display: "Ghi Danh S·ªï T·ªãch",
			rating: 5,
			isHidden: false,
			description:
				"M·ªói c√°i t√™n l√† m·ªôt c√¢u chuy·ªán. Vi·ªác l∆∞u danh v√†o s·ªï ch·ªâ l√† b∆∞·ªõc ƒë·∫ßu - nh∆∞ng l√† d·∫•u m·ªëc ƒë·∫ßu ti√™n ƒë·ªÉ n∆°i n√†y nh·ªõ ƒë·∫øn qu√Ω l·ªØ kh√°ch.",
			hint: "Ghi danh t·∫°i quy·ªÉn t·∫≠p ƒëang m·ªü",
		},
		// added
		{
			id: "giai_ma_nhan_danh",
			name: "Gi·∫£i M√£ Nh√¢n Danh",
			display: "Gi·∫£i M√£ Nh√¢n Danh",
			rating: 4,
			isHidden: false,
			description:
				"C·∫£m ∆°n v√¨ ƒë√£ d√†nh th·ªùi gian nh√¨n v√†o c√°i t√™n n√†y. Ph√≠a sau n√≥ l√† m·ªôt c√¢u chuy·ªán, nh·ªØng l·ª±a ch·ªçn, v√† c·∫£ nh·ªØng ƒëi·ªÅu ch∆∞a n√≥i th√†nh l·ªùi. Hy v·ªçng h√†nh tr√¨nh khai ph√° ·∫•y khi·∫øn ng∆∞·ªùi th·∫•y ƒë∆∞·ª£c m·ªôt ph·∫ßn th·∫≠t c·ªßa t√¥i.",
			hint: "B·∫£ng th√¥ng tin",
		},
		{
			id: "choi_bong",
			name: "Gi·∫•c M∆° S√¢n C·ªè",
			display: "Gi·∫•c M∆° S√¢n C·ªè",
			rating: 4,
			isHidden: false,
			description:
				"M·ªói c√∫ ch·∫°m b√≥ng l√† m·ªôt nh·ªãp tim. M·ªói b∆∞·ªõc ch·∫°y l√† m·ªôt m·∫£nh ∆∞·ªõc m∆° ƒë∆∞·ª£c ch·∫Øp c√°nh. C·∫£m ∆°n v√¨ ƒë√£ gh√© qua gi·∫•c m∆° n√†y - n∆°i s√¢n c·ªè kh√¥ng ch·ªâ l√† tr√≤ ch∆°i, m√† l√† c·∫£ tu·ªïi tr·∫ª.",
			hint: "PSG - PSG - PSG ‚öΩ",
		},
		// added
		{
			id: "choi_dan",
			name: "√Çm Thanh Ng·ªçt Ng√†o",
			display: "√Çm Thanh Ng·ªçt Ng√†o",
			rating: 2,
			isHidden: false,
			description:
				"Oops... Ti·∫øng g√¨ th·∫ø? √Ä, qu√Ω l·ªØ kh√°ch, ƒë·ª´ng l√†m h·ªèng c√¢y ƒë√†n c·ªßa t√¥i nh√©!",
			hint: "üé∏",
		},
		// added
		{
			id: "sy_quan",
			name: "V√¨ D·∫£i ƒê·∫•t N√†y",
			display: "V√¨ D·∫£i ƒê·∫•t N√†y",
			rating: 5,
			isHidden: false,
			description:
				"L·∫ßn ƒë·∫ßu ti√™n m√¨nh m∆° tr·ªü th√†nh m·ªôt ng∆∞·ªùi l√≠nh l√† nƒÉm l·ªõp 9, ƒë·ªÉ tr·ªü th√†nh m·ªôt ng∆∞·ªùi c√≥ th·ªÉ b·∫£o v·ªá nh·ªØng th·ª© m√¨nh th∆∞∆°ng ü™ñüáªüá≥ Gi·∫•c m·ªông v·∫´n ƒëang mang, nh∆∞ng h√†nh tr√¨nh n√†y ƒë√£ kh√°c...",
			hint: "ü™ñ",
		},
		// added
		{
			id: "tuong_tac_den",
			name: "Kh√¥ng Gian T·ªëi",
			display: "Kh√¥ng Gian T·ªëi",
			rating: 3,
			isHidden: false,
			description:
				"T·ªëi qu√°. Ta c√≥ th·ªÉ nh·∫≠n l·∫•y m·ªôt ch√∫t h√†o quang t·ª´ ng∆∞∆°i?",
			hint: "Workspace",
		},
		// added
		{
			id: "bi_an_long_dat",
			name: "B√≠ ·∫®n V·ª±c S√¢u",
			display: "B√≠ ·∫®n V·ª±c S√¢u",
			rating: 3,
			isHidden: false,
			description:
				"Th·∫ø gi·ªõi n√†y x√¢y d·ª±ng v·ªõi b·ªÅ n·ªïi, li·ªáu c√≥ t·∫£ng bƒÉng n√†o ƒëang ch√¨m kh√¥ng nh·ªâ?",
			hint: "??? -> Rapper chuy√™n nghi·ªáp",
		},
		// added
		{
			id: "hoa_hong_cua_me",
			name: "Hoa H·ªìng C·ªßa M·∫π",
			display: "Hoa H·ªìng C·ªßa M·∫π",
			rating: 3,
			isHidden: false,
			description:
				"L√† m·∫π c·ªßa t√¥i ƒë√£ n√≥i r·∫±ng b√† ·∫•y th√≠ch hoa h·ªìng, th·∫ø l√† m·∫π ch·ªçn cho t√¥i ch·∫≠u hoa n√†y. B√† n√≥i h√£y ƒë·∫∑t n√≥ ·ªü ƒë√¢y üåπüíñ",
			hint: "üåπ",
		},
		// added
		{
			id: "su_tich_cay_bonsai",
			name: "S·ª± T√≠ch C√¢y Bonsai",
			display: "S·ª± T√≠ch C√¢y Bonsai",
			rating: 3,
			isHidden: false,
			description:
				"T∆∞∆°ng truy·ªÅn c√≥ m·ªôt ng∆∞·ªùi d√†nh c·∫£ ƒë·ªùi ch·ªâ ƒë·ªÉ u·ªën m·ªôt c√¢y bonsai. M·ªói s√°ng, √¥ng t∆∞·ªõi n∆∞·ªõc, ch·ªânh t·ª´ng nh√°nh nh·ªè, d√π ch·∫≥ng ai khen. Khi ng∆∞·ªùi ta h·ªèi v√¨ sao ch∆∞a b·ªè cu·ªôc, √¥ng ch·ªâ ƒë√°p: 'V√¨ ng√†y mai n√≥ s·∫Ω ƒë·∫πp h∆°n h√¥m nay m·ªôt ch√∫t.'",
			hint: "üå≤",
		},
		{
			id: "merry_chirstmas",
			name: "K√Ω ·ª®c ƒê√™m L√†nh",
			display: "K√Ω ·ª®c ƒê√™m L√†nh",
			rating: 5,
			isHidden: true,
			unlockico: "./assets/images/ico-unlockee-mrcm.png",
			description:
				"Th√°ng 12 r·ªìi sao? T√¥i l√†m trang n√†y t·ª´ ƒë·∫ßu th√°ng 06/2025 v√† l√∫c vi·∫øt nhi·ªám v·ª• n√†y l√† l√∫c 23/06/2025. Th·ªùi gian th·∫•m tho√°t thoi ƒë∆∞a, ayyyy... L√™n ch·ªß ƒë·ªÅ Noel th√¥i~",
			hint: "üéÑ",
		},
		{
			id: "happy_birthday",
			name: "H√¥m Nay L√† M·ªôt C√¢u Chuy·ªán",
			display: "H√¥m Nay L√† M·ªôt C√¢u Chuy·ªán",
			rating: 5,
			isHidden: true,
			unlockico: "./assets/images/ico-unlockee-hpbd.gif",
			description:
				"Cu·ªôc h√†nh tr√¨nh b·∫Øt ƒë·∫ßu v√†o m·ªôt ng√†y nh∆∞ h√¥m nay, v√† s·∫Ω vi·∫øt ti·∫øp nh·ªØng c√¢u chuy·ªán cho nh·ªØng ng∆∞·ªùi mu·ªën kh√°m ph√°.",
			hint: "üéÇ",
		},
		{
			id: "bi_an_goc_khuat",
			name: "G√≥c Khu·∫•t",
			display: "G√≥c Khu·∫•t",
			rating: 5,
			isHidden: false,
			description: "Nhi·ªám v·ª• n√†y... R·ªët cu·ªôc ƒë√¢u m·ªõi l√† g√≥c khu·∫•t?",
			hint: "N∆°i m√† b·∫°n kh√¥ng th·ªÉ nh√¨n th·∫•y t·ª´ tr√™n cao",
		},
		// added
		{
			id: "dev_tools",
			name: "ƒê·ªìng Dev",
			display: "ƒê·ªìng Dev",
			rating: 5,
			isHidden: false,
			description:
				"·∫§y daaa. M·ªôt l·ªØ kh√°ch t√≤ m√≤. CƒÉn nh√† n√†y kh√¥ng c√≥ g√¨ ƒë√¢u „Éæ(‚âß‚ñΩ‚â¶*)o",
			hint: "H√£y n√≥i l·ªõn: 'T√¥i l√† l·∫≠p tr√¨nh vi√™n' 3 l·∫ßn s·∫Ω m·ªü kho√° th√†nh t·ª±u ü§°",
		},
	],
	sky: {
		currentStep: 0,
		script: [
			{
				boundary: 50,
				text: "B√† ra t·ªõi ƒë√¢y thi·ªát h·∫£ b√† Th∆° ü§°?",
			},
			{
				boundary: 60,
				text: "H√£y quay v·ªÅ ƒëi, kh√¥ng l√† tui jump scare ƒë√≥ nha",
			},
			{
				boundary: 70,
				text: "ƒêi n·ªØa l√† tui nh·∫£y xu·ªëng b√† lu√¥n b√¢y gi·ªù",
			},
			{
				boundary: 95,
				text: "ƒê∆∞·ª£c r·ªìi",
			},
			{
				boundary: 110,
				text: "Tui mu·ªën n√≥i l√†...",
			},
			{
				boundary: 120,
				text: "L√†...",
			},
			{
				boundary: 125,
				text: "L√† g√¨ nh·ªâ...?",
			},
			{
				boundary: 130,
				text: "üèÜ M·ªü kho√° th√†nh t·ª±u: Chi·∫øn binh r·∫£nh r·ªói.\nCh√∫c m·ª´ng b√† nha :))) Hi·ªán ƒë√£ m·ªü kho√°: {easter_egg_count}/{easter_egg_total} missions",
			},
		],
	},
};